{"version":3,"file":"static/js/416.7696b8ec.chunk.js","mappings":"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","sources":["../../src/locale/zh-CN.js","../../src/ScrollLoader.js","../../src/FetchScrollLoader.js"],"sourcesContent":["const locale = {\n  loadComplete: '加载完成'\n};\n\nexport default locale;\n","import React, { forwardRef, useEffect, useImperativeHandle, useRef } from 'react';\nimport { Space, Spin } from 'antd';\nimport SimpleBar from 'simplebar-react';\nimport style from './style.module.scss';\nimport { useThrottledCallback } from 'use-debounce';\nimport useRefCallback from '@kne/use-ref-callback';\nimport classnames from 'classnames';\nimport { createWithIntlProvider, useIntl } from '@kne/react-intl';\nimport zhCn from './locale/zh-CN';\nimport 'simplebar-react/dist/simplebar.min.css';\n\nconst FullDataInList = ({ getScrollerRef, loadMore, maxFullCount }) => {\n  const loaderHandler = useRefCallback(loadMore);\n  const getScroller = useRefCallback(getScrollerRef);\n  useEffect(() => {\n    let maxCount = maxFullCount;\n    const scroller = getScroller();\n    const loadMore = async () => {\n      if (scroller.clientHeight === scroller.scrollHeight && maxCount > 0) {\n        await loaderHandler().then(() => {\n          return new Promise(resolve => {\n            setTimeout(resolve, 500);\n          });\n        });\n        maxCount--;\n        await loadMore();\n      }\n    };\n    loadMore();\n  }, [maxFullCount, loaderHandler, getScroller]);\n  return null;\n};\n\nconst ScrollLoader = createWithIntlProvider(\n  'zh-CN',\n  zhCn,\n  'scroll-loader'\n)(\n  forwardRef((props, ref) => {\n    const { formatMessage } = useIntl();\n    const { className, noMore, onLoader, isLoading, completeTips, maxFullCount, children } = Object.assign(\n      {},\n      {\n        maxFullCount: 3,\n        completeTips: formatMessage({ id: 'loadComplete' })\n      },\n      props\n    );\n    const scrollerRef = useRef();\n    const onLoaderHandler = useRefCallback(onLoader);\n    const canLoadRef = useRef(!noMore && !isLoading);\n    canLoadRef.current = !noMore && !isLoading;\n\n    useImperativeHandle(ref, () => {\n      return scrollerRef.current;\n    }, []);\n    const scrollHandler = useThrottledCallback(e => {\n      const el = e.target;\n      if (canLoadRef.current && el.clientHeight + el.scrollTop + 20 > el.scrollHeight) {\n        onLoaderHandler();\n      }\n    }, 100);\n    return (\n      <SimpleBar\n        className={classnames('load-container', className)}\n        scrollableNodeProps={{\n          ref: scrollerRef,\n          onScroll: scrollHandler\n        }}\n      >\n        {!isLoading && !noMore && <FullDataInList maxFullCount={maxFullCount} getScrollerRef={() => scrollerRef.current} loadMore={onLoaderHandler} />}\n        <Space direction=\"vertical\">\n          <div>{children}</div>\n          {isLoading && !noMore ? (\n            <div className={style['scroller-no-more']}>\n              <Spin size=\"small\" />\n            </div>\n          ) : null}\n          {noMore && completeTips ? <div className={style['scroller-no-more']}>{completeTips}</div> : null}\n        </Space>\n      </SimpleBar>\n    );\n  })\n);\n\nexport default ScrollLoader;\n","import React from 'react';\nimport Fetch from '@kne/react-fetch';\nimport ScrollLoader from './ScrollLoader';\nimport get from 'lodash/get';\nimport merge from 'lodash/merge';\nimport { isNotEmpty } from '@kne/is-empty';\n\nconst FetchScrollLoader = props => {\n  const { dataFormat, mergeList, api, searchProps, getSearchProps, children, ...others } = Object.assign(\n    {},\n    {\n      api: {\n        loader: () => {\n          return {\n            pageData: [],\n            totalCount: 0\n          };\n        }\n      },\n      mergeList: (data, newData) => {\n        return Object.assign({}, newData, {\n          pageData: data.pageData.concat(newData.pageData)\n        });\n      },\n      dataFormat: data => {\n        return {\n          list: data.pageData,\n          total: data.totalCount\n        };\n      },\n      children: props => {\n        console.log(props);\n        return null;\n      }\n    },\n    props\n  );\n\n  const pagination = Object.assign(\n    {},\n    {\n      paramsType: 'data',\n      current: 'currentPage',\n      pageSizeName: 'perPage',\n      pageSize: 20\n    },\n    props.pagination\n  );\n\n  const computedSearchProps = searchProps => {\n    if (getSearchProps && isNotEmpty(searchProps)) {\n      const requestProps = getSearchProps(searchProps);\n      return isNotEmpty(requestProps) ? { [pagination.paramsType]: requestProps } : {};\n    }\n    return {};\n  };\n\n  return (\n    <Fetch\n      {...Object.assign({}, api, computedSearchProps(searchProps))}\n      render={fetchApi => {\n        const formatData = dataFormat(fetchApi.data);\n        const current = get(fetchApi.requestParams, [pagination.paramsType, pagination.current], 1),\n          pageSize = get(fetchApi.requestParams, [pagination.paramsType, pagination.pageSizeName]) || pagination.pageSize;\n\n        const noMore = !formatData.total || current * pageSize >= formatData.total;\n        const onLoader = async () => {\n          await fetchApi.loadMore(\n            merge({}, computedSearchProps(searchProps), {\n              [pagination.paramsType]: {\n                [pagination.pageSizeName]: pageSize,\n                [pagination.current]: current + 1\n              }\n            }),\n            mergeList\n          );\n        };\n\n        return (\n          <ScrollLoader {...others} isLoading={!fetchApi.isComplete} noMore={noMore} onLoader={onLoader}>\n            {children({ fetchApi, list: formatData.list, data: fetchApi.data })}\n          </ScrollLoader>\n        );\n      }}\n    />\n  );\n};\n\nexport default FetchScrollLoader;\n"],"names":["FullDataInList","_ref","getScrollerRef","loadMore","maxFullCount","loaderHandler","useRefCallback","getScroller","useEffect","maxCount","scroller","async","clientHeight","scrollHeight","then","Promise","resolve","setTimeout","ScrollLoader","createWithIntlProvider","loadComplete","forwardRef","props","ref","formatMessage","useIntl","className","noMore","onLoader","isLoading","completeTips","children","Object","assign","id","scrollerRef","useRef","onLoaderHandler","canLoadRef","current","useImperativeHandle","scrollHandler","useThrottledCallback","e","el","target","scrollTop","React","SimpleBar","classnames","scrollableNodeProps","onScroll","Space","direction","style","Spin","size","FetchScrollLoader","_Object$assign","api","loader","pageData","totalCount","mergeList","data","newData","concat","dataFormat","list","total","console","log","searchProps","getSearchProps","others","_objectWithoutPropertiesLoose","_excluded","pagination","paramsType","pageSizeName","pageSize","computedSearchProps","isNotEmpty","requestProps","Fetch","_extends","render","fetchApi","formatData","get","requestParams","isComplete","merge"],"sourceRoot":""}